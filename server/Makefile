.PHONY: dev start test clean help

# Cores para output
BLUE := \033[0;34m
GREEN := \033[0;32m
NC := \033[0m # No Color

help: ## Mostra esta mensagem de ajuda
	@echo "${BLUE}Comandos disponÃ­veis para o backend:${NC}"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "${GREEN}%-15s${NC} %s\n", $$1, $$2}'

dev: ## Inicia servidor em modo desenvolvimento (nodemon)
	@echo "${BLUE}ğŸ”§ Iniciando servidor backend...${NC}"
	@npm run dev

start: ## Inicia servidor em modo produÃ§Ã£o
	@echo "${BLUE}ğŸš€ Iniciando servidor em produÃ§Ã£o...${NC}"
	@npm start

test: ## Roda testes do backend
	@echo "${BLUE}ğŸ§ª Executando testes...${NC}"
	@npm test

test-watch: ## Roda testes em modo watch
	@echo "${BLUE}ğŸ‘€ Executando testes em watch mode...${NC}"
	@npm run test:watch

clean: ## Remove node_modules
	@echo "${BLUE}ğŸ§¹ Removendo node_modules...${NC}"
	@rm -rf node_modules
	@echo "${GREEN}âœ… Limpeza completa!${NC}"

install: ## Instala dependÃªncias
	@echo "${BLUE}ğŸ“¦ Instalando dependÃªncias...${NC}"
	@npm install
	@echo "${GREEN}âœ… DependÃªncias instaladas!${NC}"

migrate: ## Roda migraÃ§Ãµes do banco de dados
	@echo "${BLUE}ğŸ—„ï¸  Executando migraÃ§Ãµes...${NC}"
	@node migrations/run-migrations.js

logs: ## Mostra logs do servidor (se estiver rodando em background)
	@tail -f logs/server.log
